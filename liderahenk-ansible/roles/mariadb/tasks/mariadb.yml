- name: Create root's .my.cnf file
  copy:
    content: |
      [client]
      user=root
      password=1
    dest: /root/.my.cnf
    owner: root
    group: root
    mode: '0600'

- name: MariaDB | Preset root password
  debconf:
    name: 'mariadb-server'
    question: 'mariadb-server/root_password'
    value: '<ROOT_PASSWORD>'
    vtype: password
  vars:
    ROOT_PASSWORD: "1"

- name: Install MariaDB package
  apt:
    name:
      - mariadb-server
      - python3-mysqldb
    state: present

- name: Print message
  debug:
    msg: "mariadb-server is installed"

- name: Create Mysql configuration file
  copy:
    src: templates/my.cnf.j2
    dest: /root/my.cnf
    owner: root
    group: root
    mode: '0644'

- name: Comment out bind-address in 50-server.cnf
  ansible.builtin.lineinfile:
    path: /etc/mysql/mariadb.conf.d/50-server.cnf
    regexp: '^bind-address'
    line: '#bind-address            = 127.0.0.1'
    backup: yes
  become: true

- name: Start MariaDB Service
  service:
    name: mariadb
    state: started
    enabled: yes

- name: Print message
  debug:
    msg: "mariadb-server service is started"

- name: Create a new database with name 'lidermysdb'
  community.mysql.mysql_db:
    name: lidermysdb
    state: present
    login_unix_socket: /var/run/mysqld/mysqld.sock

- name: Create database user with name 'AGAH' and password '12345' with all database privileges
  community.mysql.mysql_user:
    name: root
    password: "1"
    priv: "*.*:ALL,GRANT"
    host: '%'
    state: present
    login_unix_socket: /var/run/mysqld/mysqld.sock
    login_user: root

- name: Start MariaDB Service
  service:
    name: mariadb
    state: restarted
    enabled: yes

- name: Print message
  debug:
    msg: "mariadb-server service is started"


- name: Select query to lidermysdb 
  community.mysql.mysql_query:
    login_db: lidermysdb
    query: CREATE TABLE c_config (config_id INT NOT NULL, create_date VARCHAR(45) NOT NULL, modify_date VARCHAR(45) NULL, name VARCHAR(45) NOT NULL, value LONGTEXT NULL, PRIMARY KEY (config_id))

- name: Select query to test_db with named_args
  community.mysql.mysql_query:
    login_db: lidermysdb
    query: >
      INSERT INTO c_config (config_id, create_date, modify_date, name, value)
      VALUES (1, "2022-11-18 15:59:41", null, "liderConfigParams", '{{ json_data | to_json }}');
